---
import Layout from './Layout.astro';

export interface Props {
  title: string;
  description: string;
  pubDate: Date;
  heroImage?: string;
  slug: string;
  metaTitle?: string;
  tags?: string[];
}

const { title, description, pubDate, heroImage, slug, metaTitle, tags } = Astro.props;

const pageTitle = metaTitle || title;

// SEO data
const canonicalURL = new URL(Astro.url.pathname, Astro.site || 'http://localhost:4321');

// Handle heroImage URL - ensure it's a valid absolute URL
let heroImageURL;
if (heroImage) {
  try {
    heroImageURL = heroImage.startsWith('http') 
      ? heroImage 
      : new URL(heroImage.startsWith('/') ? heroImage.slice(1) : heroImage, Astro.site || 'http://localhost:4321');
  } catch {
    heroImageURL = undefined;
  }
}

const structuredData = {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": title,
  "description": description,
  "image": heroImageURL ? heroImageURL.toString() : undefined,
  "datePublished": pubDate.toISOString(),
  "dateModified": pubDate.toISOString(),
  "author": {
    "@type": "Person",
    "name": "Redactor SEO",
    "url": (Astro.site || 'http://localhost:4321').toString()
  },
  "publisher": {
    "@type": "Organization",
    "name": "Redactor SEO",
    "url": (Astro.site || 'http://localhost:4321').toString()
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": canonicalURL.toString()
  }
};

const formattedDate = pubDate.toLocaleDateString('es-ES', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});
---

<Layout title={pageTitle} description={description}>
  <Fragment slot="head">
    <!-- SEO Meta Tags -->
    <link rel="canonical" href={canonicalURL} />
    <meta property="og:type" content="article" />
    <meta property="og:title" content={pageTitle} />
    <meta property="og:description" content={description} />
    <meta property="og:url" content={canonicalURL} />
    {heroImageURL && <meta property="og:image" content={heroImageURL.toString()} />}
    <meta property="article:published_time" content={pubDate.toISOString()} />
    <meta property="article:author" content="Redactor SEO" />
    {tags && <meta name="keywords" content={tags.join(', ')} />}
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={pageTitle} />
    <meta name="twitter:description" content={description} />
    {heroImageURL && <meta name="twitter:image" content={heroImageURL.toString()} />}
    
    <!-- Structured Data -->
    <script type="application/ld+json" set:html={JSON.stringify(structuredData)} />
  </Fragment>

  <article class="min-h-screen bg-white">
    <!-- Article Header -->
    <header class="bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white py-16 lg:py-20">
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Breadcrumb -->
        <nav class="mb-8" aria-label="Breadcrumb">
          <ol class="flex items-center space-x-2 text-sm text-gray-300">
            <li><a href="/" class="hover:text-white transition-colors">Inicio</a></li>
            <li><span class="text-gray-500">/</span></li>
            <li><a href="/blog" class="hover:text-white transition-colors">Blog</a></li>
            <li><span class="text-gray-500">/</span></li>
            <li class="text-gray-400 truncate">{title}</li>
          </ol>
        </nav>
        
        <div class="space-y-6">
          <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold leading-tight">
            {title}
          </h1>
          
          <p class="text-xl text-gray-300 max-w-3xl">
            {description}
          </p>
          
          <div class="flex items-center space-x-4 text-sm text-gray-400">
            <time datetime={pubDate.toISOString()}>
              {formattedDate}
            </time>
            <span>•</span>
            <span>Por Redactor SEO</span>
          </div>
        </div>
      </div>
    </header>

    <!-- Hero Image -->
    {heroImage && (
      <div class="relative h-64 md:h-80 lg:h-96 overflow-hidden">
        <img
          src={heroImage}
          alt={title}
          class="w-full h-full object-cover"
        />
        <div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent"></div>
      </div>
    )}

    <!-- Article Content -->
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12 lg:py-16">
      <div class="article-content">
        <slot />
      </div>
      
      <!-- Article Footer -->
      <footer class="mt-16 pt-8">
        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl p-8">
          <div class="text-center">
            <h3 class="text-2xl font-bold text-gray-900 mb-4">
              ¿Te ha resultado útil este artículo?
            </h3>
            <p class="text-gray-600 mb-6 max-w-2xl mx-auto">
              Si necesitas ayuda con tu estrategia de contenidos SEO, estaré encantado de ayudarte a conseguir mejores resultados.
            </p>
            <a
              href="/contacto"
              class="inline-block bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-full font-semibold transition-colors duration-300 shadow-lg hover:shadow-xl"
            >
              Contactar ahora
            </a>
          </div>
        </div>
        
      </footer>
    </div>

    <!-- Related Articles CTA -->
    <section class="bg-gray-50 py-16">
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <h3 class="text-3xl font-bold text-gray-900 mb-4">
          Más artículos sobre SEO
        </h3>
        <p class="text-gray-600 mb-8">
          Descubre más consejos y estrategias para mejorar tu posicionamiento web
        </p>
        <a
          href="/blog"
          class="inline-block bg-gray-900 hover:bg-gray-800 text-white px-8 py-3 rounded-full font-semibold transition-colors duration-300"
        >
          Ver todos los artículos
        </a>
      </div>
    </section>
  </article>
</Layout>
