---
import Layout from '../layouts/Layout.astro'
import { getEntry } from 'astro:content'

let entry, sobreContent
try {
  entry = await getEntry('sobre-mi', 'index')
  if (entry) {
    sobreContent = entry.data
  }
} catch (error) {
  console.error('Error loading sobre-mi content:', error)
}

const baseUrl = 'https://redactorseo.es'

// Valores por defecto si no se puede cargar el contenido
const defaultData = {
  title: "Soy Álvaro",
  subtitle: "Redactor SEO",
  profileImage: "/alvaro-seo.jpg",
  storyContent: "Aquí va tu historia..."
}

const data = sobreContent || defaultData
---

<Layout title={data.seo?.title || "Sobre Mí - Álvaro Pérez | Redactor SEO"} description={data.seo?.description}>
  <Fragment slot="head">
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@graph": [
        {
          "@type": "BreadcrumbList",
          "itemListElement": [
            {
              "@type": "ListItem",
              "position": 1,
              "name": "Inicio",
              "item": baseUrl
            },
            {
              "@type": "ListItem",
              "position": 2,
              "name": "Sobre Mí",
              "item": `${baseUrl}/sobre-mi`
            }
          ]
        },
        {
          "@type": "Person",
          "@id": `${baseUrl}/sobre-mi#person`,
          "name": "Álvaro Pérez",
          "jobTitle": "Redactor SEO",
          "description": "Redactor SEO especializado en contenido que posiciona, conecta y convierte.",
          "url": `${baseUrl}/sobre-mi`,
          "image": `${baseUrl}/alvaro-seo.jpg`,
          "email": "info@redactorseo.es",
          "worksFor": {
            "@id": `${baseUrl}/#organization`
          },
          "knowsAbout": ["SEO", "Content Marketing", "Copywriting", "Redacción Web"],
          "address": {
            "@type": "PostalAddress",
            "addressCountry": "ES"
          }
        }
      ]
    })} />
  </Fragment>

  <!-- Main Content -->
  <section class="py-20 md:py-32 lg:py-40 bg-white">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-12 xl:px-16">
      <!-- Header with Image -->
      <div class="flex flex-col lg:flex-row gap-12 items-center lg:items-start mb-16">
        <!-- Text Content -->
        <div class="flex-1 text-center lg:text-left">
          <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold leading-tight mb-4">
            {data.title || "Soy Álvaro"}
          </h1>
          {data.subtitle && (
            <p class="text-xl md:text-2xl text-gray-600">
              {data.subtitle}
            </p>
          )}
        </div>

        <!-- Profile Image -->
        <div class="flex-shrink-0">
          <div class="w-64 h-64 md:w-80 md:h-80">
            <img
              src={data.profileImage || "/alvaro-seo.jpg"}
              alt="Álvaro Pérez - Redactor SEO"
              class="w-full h-full rounded-lg object-contain"
              loading="lazy"
              width="320"
              height="320"
            />
          </div>
        </div>
      </div>

      <!-- Story Content -->
      <div class="max-w-3xl mx-auto mb-16">
        {data.storyContent && data.storyContent.split('\n\n').map((block: string) => {
          // Check if block contains bullet points
          const lines = block.split('\n');
          const hasBullets = lines.some(line => line.trim().startsWith('-'));

          if (hasBullets) {
            // Process as list
            const listItems = lines
              .filter(line => line.trim().startsWith('-'))
              .map(line => line.trim().substring(1).trim());

            return (
              <ul class="space-y-3 mb-8">
                {listItems.map((item: string) => (
                  <li class="flex items-start space-x-3">
                    <svg class="w-5 h-5 text-naranja-vibrante flex-shrink-0 mt-1" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                    </svg>
                    <span class="text-lg text-gray-700">{item}</span>
                  </li>
                ))}
              </ul>
            );
          } else {
            // Process as paragraph
            return <p class="text-xl text-gray-600 leading-relaxed mb-8">{block}</p>;
          }
        })}
      </div>
    </div>
  </section>

  <!-- CTA Section -->
  <section class="py-20 md:py-32 lg:py-40 bg-black text-white">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-12 xl:px-16 text-center">
      <h2 class="text-3xl md:text-4xl font-bold mb-6">
        {data.cta?.title || "¿Listo para hacer crecer tu negocio?"}
      </h2>
      <p class="text-xl text-gray-300 mb-10 leading-relaxed max-w-3xl mx-auto">
        {data.cta?.description || "Cuéntame tu proyecto y te explico cómo puedo ayudarte a conseguir más clientes"}
      </p>
      <a href={data.cta?.buttonUrl || "/contacto"} class="bg-naranja-vibrante text-white px-8 py-4 rounded-lg text-lg font-bold hover:bg-naranja-vibrante-hover hover:scale-105 transition-all duration-300 inline-block">
        {data.cta?.buttonText || "Empezar mi proyecto"}
      </a>
    </div>
  </section>
</Layout>